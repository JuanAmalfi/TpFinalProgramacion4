@if (libro()) {
<div class="detalle-wrapper">

  <div class="detalle-card glass fade-in">

    <!-- COLUMNA LEFT (Imagen + botones) -->
    <div class="left-box">

      <div class="img-box">
        <img [src]="libro().portada || 'assets/placeholder.png'" alt="{{ libro().titulo }}">
      </div>

      <div class="btn-group">
        <button class="btn volver" (click)="volver()">Volver</button>

        @if (estaLogueado()) {
        <button class="btn carrito" (click)="agregarAlCarrito()">
          üõí Agregar al Carrito
        </button>
        } @else {
        <button class="btn login" (click)="irALogin()">
          üîê Inicia sesi√≥n
        </button>
        }

        @if (isAdmin()) {
        <button class="btn editar" (click)="editarLibro()">Editar</button>
        <button class="btn eliminar" (click)="eliminarLibro()">Eliminar</button>
        }
      </div>
    </div>

    <!-- COLUMNA RIGHT (Info + rese√±as) -->
    <div class="info-box">
      <h2 class="titulo">{{ libro().titulo }}</h2>

      <!-- üîî ALERTA DE MENSAJES -->
      @if (mensaje()) {
        <div class="alert">
          {{ mensaje() }}
        </div>
      }

      <p><span>Autor:</span> {{ libro().autor }}</p>
      <p><span>G√©nero:</span> {{ libro().genero }}</p>
      <p><span>A√±o:</span> {{ libro().anioPublicacion }}</p>
      <p><span>Precio:</span> ${{ libro().precio }}</p>

      <div class="descripcion-block">
        <p><span>Descripci√≥n:</span></p>
        <p class="descripcion">{{ libro().descripcion || 'Sin descripci√≥n disponible.' }}</p>
      </div>

      <!-- ‚≠ê RESE√ëAS -->
      <div class="resenas-block">
        <h3>Rese√±as de usuarios</h3>

        @if (resenias().length === 0) {
        <p class="no-resenas">A√∫n no hay rese√±as</p>
        } @else {
        @for (r of resenias(); track r.id) {
        <div class="resena-item">
          <p class="user"><i class="fa-solid fa-user"></i> {{ r.username }}</p>

          <div class="stars">
            @for (star of generarEstrellas(r.calificacion); track $index) {
            <span>{{ star }}</span>
            }
          </div>

          <p class="comentario">"{{ r.comentario }}"</p>
          
          @if (isAdmin()) {
          <button class="btn eliminar-admin" (click)="eliminarResenaAdmin(r.id)">
            ‚ùå Eliminar rese√±a
          </button>
          }
        </div>
        }
        }
      </div>
    </div>

  </div>
</div>
} @else {
<p class="not-found fade-in">Libro no encontrado</p>
}
